### xss

攻击者通过代码注入的方式，恶意篡改受害者所访问的网站内容；把受害者引导到恶意网站；窃取受害者 cookie 等信息而假冒受害者身份的一种前端攻击技术

#### xss 分类

1. 存储型 xss

  攻击者访问网站，提交了一个包含恶意代码的评论数据，服务器没有处理直接将该代码存储；等其他用户打开该页面时，服务器返回的数据中包含了攻击者的恶意代码，其他用户的电脑就执行了该代码

2. 反射型 xss

  反射性xss 和 存储型 xss 有相似之处，只不过最大的区别在于反射型的不会存储进数据库。

  主要是诱导用户去点击包含恶意代码的网址。举个例子就是搜索：攻击者把搜索关键词设置为 js 脚本，用户打开后，服务端直接返回了该关键词，客户端执行了该代码

#### 应对

1. httpOnly 防止劫持 cookie
2. 不相信用户的任何输入，即对用户的输入要进行检查、过滤、转义
3. 对输出也要进行检查

### csrf

跨站伪造请求。攻击者借助受害者的 cookie 骗取服务器的信任，从而在受害者不知情的情况下以受害者的名义伪造请求发送给服务器。

#### 攻击流程

1. 受害者登录 A 网站，并且保留了登录凭证
2. 攻击者诱惑受害者登录了 B 网站
3. B 网站往 A 网站服务器发送了一个请求
4. 服务器检验到受害者的登录凭证是正确的，就会执行该请求

#### 攻击类型

1. get 方式

  伪造一个可自动执行的地址：script 标签、img 标签等，地址内包含所请求的信息

2. post 方式
   
  一般是一个自动提交的表单：创建一个表单，然后 js 执行 submit 操作。

3. 地址方式
   
  诱惑用户直接点击已经构造好的链接

#### csrf 特点

- 攻击一般发起在第三方网站，而不是被攻击的网站
- 攻击利用的是被攻击网站的登录凭证，冒充受害者提交，而不是直接窃取数据
- 整个过程攻击者并不能获取到受害者的登录凭证，仅仅是“冒用”
- 跨站可以利用各种方式：图片 url、超链接、form 提交等
- csrf 通常是跨域的，这也让攻击更难防范

#### 防范

利用 csrf 的两个特点：

- 通常发生在第三方域名
- csrf 攻击者不能获取到 cookie 等信息，只是冒用

那么可以做出以下的防护策略：

1. 同源检测
   
  既然 csrf 大部分来源于第三方网站，那么可以直接禁止外域发起请求。浏览器在发送请求的时候会携带两个header 来标记来源域名：origin Header 和 Referer Header，如果不是来自于同一来源的，则直接禁止。

  这种方法只是对第三方网站请求有效，如果是直接在本网站发起的攻击，是无法防御的。（那么怎么在本网站发起呢？类似存储型 xss 的方式）

2. token

  设置一个 token 作为唯一识别值放入参数中。因为攻击者只是冒用了 cookie 等自动发送的数据，对于参数中的值是无法设置的，在每次发送请求的时候，都需要重新生成该参数，服务器通过校验时候携带该 token 来判断请求是否正确

  token 可以通过随机字符串和时间戳的组合来实现。可以参考公司网关请求时的 header 头构造：各种加密与签名认证。
