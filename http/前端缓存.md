## 缓存

在介绍缓存的时候，我们习惯将缓存分为强缓存和协商缓存两种。两者的主要区别是使用本地缓存的时候，是否需要向服务器验证本地缓存是否依旧有效。顾名思义，协商缓存，就是需要和服务器进行协商，最终确定是否使用本地缓存。

### 按协议分：协议层缓存和非 http 协议缓存

1. 协议层缓存：使用 http 协议头属性设置
2. 非协议层缓存：使用 mate 标签的 http-equiv 属性值 Expires, set-cookie

### 按缓存分：强缓存和协商缓存

1. 强缓存：使用 cache-contorl 和 Expires 设置，直接返回一个过期时间，缓存期间不重新请求
2. 协商缓存：响应头返回 etag 或 last-modified 的哈希值，第二次请求头 if-none-match 或 if-modify-since 携带上次哈希值，一致则返回 304，即本地缓存

## 两种缓存方案的问题点

### 强缓存

强缓存主要是通过 http 请求头中的 Cache-control 和 Expire 两个字段控制。

一般，通过设置Cache-Control的值为“public, max-age=xxx”，表示在xxx秒内再次访问该资源，均使用本地的缓存，不再向服务器发起请求。

显而易见，如果在xxx秒内，服务器上面的资源更新了，客户端在没有强制刷新的情况下，看到的内容还是旧的。

### 协商缓存

协商缓存最大的问题就是每次都要向服务器验证一下缓存的有效性。

### 读取缓存流程

1. 先判断强缓存
2. 在判断协商缓存 etag (last-modified) 是否存在
3. 存在则利用属性 if-None-match(if-Modify-since) 携带上一次hash值请求服务器，服务器对比 etag，相对则返回304

## 最佳实践

缓存的意义就在于减少请求，更多地使用本地的资源，给用户更好的体验的同时，也减轻服务器压力。所以，最佳实践，就应该是尽可能命中强缓存，同时，能在更新版本的时候让客户端的缓存失效。

综上所述，我们可以得出一个较为合理的缓存方案：

- HTML：使用协商缓存。
- CSS&JS&图片：使用强缓存，文件命名带上hash值。